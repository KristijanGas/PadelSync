<!DOCTYPE html>
<html>
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <script src="/scripts/reservations.js" defer></script>
        <script src="/scripts/commentHandler.js" defer></script>
        <script src="/scripts/socket.js" defer></script>
        <script src="/socket.io/socket.io.js"></script>
        <link rel="stylesheet" href="/styles/terrain.css">
    </head>

    <body>
        <div class="BackgroundTop">
            <div class="TopHeaderContainer">
                <a href="/terrain_search" class="backButton">← Back to Search</a>
                <h1>Terrain <%= teren.imeTeren %></h1>
            </div>
        </div>

        <div class="Block1">
            <div class="InfoAndMenuContainer">
                <div class="TerrainInfoContainer">

                    <h2>Terrain Information:</h2>

                    <div class="TerrainInfoItemName">Owner:</div>
                    <div class="TerrainInfoItem"><%= teren.username %></div>
                    <br>
                    
                    <div class="TerrainInfoItemName">Surface Type:</div>
                    <div class="TerrainInfoItem"><%= teren.tipPodloge %></div>
                    <br>

                    <div class="TerrainInfoItemName">Terrain Type:</div>
                    <div class="TerrainInfoItem"><%= teren.vanjskiUnutarnji %></div>
                    <br>

                    <div class="TerrainInfoItemName">Terrain Price:</div>
                    <div class="TerrainInfoItem"><%= teren.cijenaTeren %></div>
                    <br>

                </div>

                <div class="ReservationContainer">

                    <%if (typeof jednokratniTermini !== 'undefined') {%>
                        <%if (jednokratniTermini.length > 0) {%>
                            <p>One-time slots for the next 5 weeks:</p>
                            <% for(let termin of jednokratniTermini) {%>
                                <form class="formaRezervacije" enctype="multipart/form-data" method="POST">
                                    <h2><%= termin.datum %> u <%= termin.vrijemePocetak %> do <%= termin.vrijemeKraj %> sati.</h2>
                                    <%if(cardAllowed){%>
                                        <p>Select Payment Method</p>
                                        <input type="radio" id="gotovina" name="tipPlacanja" value="gotovina" required>
                                        <label for="tipPlacanja">Cash</label>
                                        <input type="radio" id="kartica" name="tipPlacanja" value="kartica">
                                        <label for="tipPlacanja">Card</label>
                                    <%}else{%>
                                        <p>This club only supports cash payments</p>
                                    <%}%>
                                    <input type="hidden" name="terminID" value=<%= termin.terminID %>>
                                    <input type="hidden" name="datum" value=<%= termin.datum %>><br>
                                    <input type="hidden" name="klub" value=<%= termin.klub %>>
                                    <div
                                    id="terminInfo"
                                    data-termin='<%- JSON.stringify(termin) %>'
                                    data-teren='<%- JSON.stringify(teren) %>'
                                    data-tip-termina="jednokratni"
                                    ></div>
                                    <button type="button">Show in Calendar</button>
                                    <input type="submit" value="Rerezviraj?">
                                </form>
                            <% }%>
                        <%} else {%>
                            <p>No available slots.</p>
                        <%}%>
                    <%}%>
                    <%if(typeof pretplate !== 'undefined' && cardAllowed) {%>
                        <p>The club currently offers the following subscription plans for recurring slots:</p>
                        <%for(let pretplata of pretplate) {%>
                            <form class="formaPretplata" enctype="multipart/form-data" method="post">
                            <p>Subscription <%=pretplata.pretpNaziv%>, costs <%=pretplata.pretpCijena%>€ per week.</p>
                            <%if(pretplata.poducavanje !== null){%>
                                <p>This subscription includes coaching.</p>
                            <%}%>
                            <p>Slots linked to this subscription are: (0 = Sunday)</p>
                            <div class="pretpTermini">
                            <%if (typeof pretplata.termini === 'undefined' || pretplata.termini.length === 0) { %>
                                <p>No available slots for this subscription at the moment.</p>
                            <% } %>
                            <%if (typeof pretplata.termini !== 'undefined' && pretplata.termini.length > 0) { %>
                                <%for(let termin of pretplata.termini){%>
                                    <p>On day <%=termin.danTjedan%> from <%=termin.vrijemePocetak%> to <%=termin.vrijemeKraj%> on terrain ID <%=termin.terenID%></p>
                                <%}%>
                            <%}%>
                            </div>
                            <div id="pretpInfo"
                            data-pretp='<%- JSON.stringify(pretplata) %>'
                            data-tip-termina="ponavljajuci"></div>
                            <input type="submit" value="Rezerviraj?">
                            </form>
                        <%}%>
                    <%} else { %>
                        <p>This club currently has no subscription plans available for recurring bookings for this terrain.</p>
                    <%}%>
                    <%if(addComment){%>
                        <form class="commentForm" action="/terrain/<%= teren.terenID %>/addComment" method="POST">
                            <label for="komentar">Add your comment:</label>
                            <textarea id="komentar" name="komentar" rows="12" cols="40" placeholder="Napišite komentar" required></textarea><br><br>
                            <label for="ocjena">Rating</label>
                            <input type="number" name="ocjena" id="ocjena" required><br><br>
                            <button type="submit">Post Comment</button>
                        </form>
                    <%}%>
                </div>
            </div>
            <div class="CalendarContainer">
                <p>Calendar goes here</p>
            </div>
        </div>
    </body>
</html>